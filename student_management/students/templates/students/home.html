<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Management API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
        }

        h1 {
            text-align: center;
            margin: 20px;
        }

        .top-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        .top-buttons a {
            text-decoration: none;
            padding: 10px 20px;
            margin: 0 10px;
            background: #3498db;
            color: white;
            border-radius: 6px;
        }

        .form-container {
            background: #fff;
            max-width: 400px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .form-container h2 {
            text-align: center;
        }

        .form-container input, .form-container select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 6px;
        }

        .form-container button {
            width: 100%;
            padding: 10px;
            background: #2ecc71;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .form-container button:hover {
            background: #27ae60;
        }

        /* Filters */
        .filters {
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            max-width: 900px;
        }

        .filters input, .filters select, .filters button {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            min-width: 180px;
        }

        .filters button {
            background: #3498db;
            color: white;
            cursor: pointer;
            min-width: auto;
        }

        .filters button:hover {
            background: #2980b9;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 12px;
            text-align: center;
        }

        th {
            background: #3498db;
            color: white;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        .actions button {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .edit-btn {
            background: #f39c12;
            color: white;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Welcome to Student Management API</h1>
    <div class="top-buttons">
        <a href="/api/students/">Students API</a>
        <a href="/admin/">Admin Panel</a>
    </div>

    <!-- Student Form -->
    <div class="form-container">
        <h2>Add a New Student</h2>
        <input type="text" id="name" placeholder="Enter name">
        <input type="number" id="age" placeholder="Enter age">
        <input type="email" id="email" placeholder="Enter email">
        <select id="department">
            <option value="">Select Department</option>
        </select>
        <select id="course">
            <option value="">Select Course</option>
        </select>
        <button onclick="addStudent()">Add Student</button>
    </div>

    <!-- Filters -->
    <div class="filters">
        <input type="text" id="searchBox" placeholder="Search by name or email">
        <select id="deptFilter">
            <option value="">All Departments</option>
        </select>
        <select id="courseFilter">
            <option value="">All Courses</option>
        </select>
        <button onclick="applySearch()">Search</button>
    </div>

    <!-- Student Table -->
    <h2 style="text-align:center;">Student List</h2>
    <table id="studentTable">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Name</th>
                <th>Age</th>
                <th>Email</th>
                <th>Department</th>
                <th>Course</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        let students = [];
        let departments = [];
        let courses = [];

        async function fetchData() {
            let studentRes = await fetch('/api/students/');
            students = await studentRes.json();

            let deptRes = await fetch('/api/departments/');
            departments = await deptRes.json();

            let courseRes = await fetch('/api/courses/');
            courses = await courseRes.json();

            populateDepartments();
            populateCourses();
            renderTable();
        }

        function populateDepartments() {
            let deptSelect = document.getElementById('department');
            let filterSelect = document.getElementById('deptFilter');
            deptSelect.innerHTML = `<option value="">Select Department</option>`;
            filterSelect.innerHTML = `<option value="">All Departments</option>`;
            departments.forEach(d => {
                let option = new Option(d.name, d.id);
                deptSelect.add(option.cloneNode(true));
                filterSelect.add(new Option(d.name, d.id));
            });
        }

        function populateCourses() {
            let courseSelect = document.getElementById('course');
            let filterSelect = document.getElementById('courseFilter');
            courseSelect.innerHTML = `<option value="">Select Course</option>`;
            filterSelect.innerHTML = `<option value="">All Courses</option>`;
            courses.forEach(c => {
                let option = new Option(c.name, c.id);
                courseSelect.add(option.cloneNode(true));
                filterSelect.add(new Option(c.name, c.id));
            });
        }

        function getDeptName(id) {
            let dept = departments.find(d => d.id === id);
            return dept ? dept.name : "—";
        }

        function getCourseName(id) {
            let course = courses.find(c => c.id === id);
            return course ? course.name : "—";
        }

        function renderTable() {
            let tbody = document.querySelector("#studentTable tbody");
            tbody.innerHTML = "";

            let search = document.getElementById("searchBox").value.toLowerCase().trim();
            let deptFilter = document.getElementById("deptFilter").value;
            let courseFilter = document.getElementById("courseFilter").value;

            let filtered = students.filter(s => {
                return (
                    (search === "" || s.name.toLowerCase().includes(search) || s.email.toLowerCase().includes(search)) &&
                    (deptFilter === "" || s.department == deptFilter) &&
                    (courseFilter === "" || s.course == courseFilter)
                );
            });

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7">No students found</td></tr>`;
                return;
            }

            filtered.forEach((s, index) => {
                let row = `<tr>
                    <td>${index + 1}</td>
                    <td>${s.name}</td>
                    <td>${s.age}</td>
                    <td>${s.email}</td>
                    <td>${getDeptName(s.department)}</td>
                    <td>${getCourseName(s.course)}</td>
                    <td class="actions">
                        <button class="edit-btn" onclick="editStudent(${s.id})">✏️</button>
                        <button class="delete-btn" onclick="deleteStudent(${s.id})">❌</button>
                    </td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function applySearch() {
            renderTable();
        }

        // Allow Enter key to trigger search
        document.getElementById("searchBox").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                applySearch();
            }
        });

        async function addStudent() {
            let student = {
                name: document.getElementById("name").value,
                age: document.getElementById("age").value,
                email: document.getElementById("email").value,
                department: parseInt(document.getElementById("department").value),
                course: parseInt(document.getElementById("course").value)
            };

            await fetch('/api/students/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(student)
            });

            fetchData();
        }

        async function deleteStudent(id) {
            await fetch(`/api/students/${id}/`, { method: 'DELETE' });
            fetchData();
        }

        function editStudent(id) {
            alert("Edit function coming soon for Student ID: " + id);
        }

        fetchData();
    </script>
</body>
</html>
